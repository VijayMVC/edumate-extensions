WITH CASUAL_BLOB AS
(
  SELECT
    CONTACT.FIRSTNAME || ' ' || CONTACT.SURNAME AS "ORIGINAL_TEACHER",
    TO_CHAR((CURRENT DATE), 'Month DD') AS "CASUAL_DATE",
    REPLACEMENT,
    REPLACEMENT_STAFF_ID,
    PERIOD,
    START_TIME,
    END_TIME

  FROM TABLE(EDUMATE.GET_SCHEDULES_ON_DATE(CURRENT DATE)) SCHEDS

  INNER JOIN STAFF ON STAFF.STAFF_ID = SCHEDS.STAFF_ID
  INNER JOIN CONTACT ON CONTACT.CONTACT_ID = STAFF.CONTACT_ID

  WHERE REPLACEMENT_STAFF_ID IS NOT NULL
  
  UNION ALL
  
  SELECT
    CONTACT.FIRSTNAME || ' ' || CONTACT.SURNAME AS "ORIGINAL_TEACHER",
    TO_CHAR((CURRENT DATE - 1 DAYS), 'Month DD') AS "CASUAL_DATE",
    REPLACEMENT,
    REPLACEMENT_STAFF_ID,
    PERIOD,
    START_TIME,
    END_TIME

  FROM TABLE(EDUMATE.GET_SCHEDULES_ON_DATE(CURRENT DATE - 1 DAYS)) SCHEDS

  INNER JOIN STAFF ON STAFF.STAFF_ID = SCHEDS.STAFF_ID
  INNER JOIN CONTACT ON CONTACT.CONTACT_ID = STAFF.CONTACT_ID

  WHERE REPLACEMENT_STAFF_ID IS NOT NULL
  
  UNION ALL
  
  SELECT
    CONTACT.FIRSTNAME || ' ' || CONTACT.SURNAME AS "ORIGINAL_TEACHER",
    TO_CHAR((CURRENT DATE - 2 DAYS), 'Month DD') AS "CASUAL_DATE",
    REPLACEMENT,
    REPLACEMENT_STAFF_ID,
    PERIOD,
    START_TIME,
    END_TIME

  FROM TABLE(EDUMATE.GET_SCHEDULES_ON_DATE(CURRENT DATE - 2 DAYS)) SCHEDS

  INNER JOIN STAFF ON STAFF.STAFF_ID = SCHEDS.STAFF_ID
  INNER JOIN CONTACT ON CONTACT.CONTACT_ID = STAFF.CONTACT_ID

  WHERE REPLACEMENT_STAFF_ID IS NOT NULL
  
  UNION ALL
  
  SELECT
    CONTACT.FIRSTNAME || ' ' || CONTACT.SURNAME AS "ORIGINAL_TEACHER",
    TO_CHAR((CURRENT DATE - 3 DAYS), 'Month DD') AS "CASUAL_DATE",
    REPLACEMENT,
    REPLACEMENT_STAFF_ID,
    PERIOD,
    START_TIME,
    END_TIME

  FROM TABLE(EDUMATE.GET_SCHEDULES_ON_DATE(CURRENT DATE - 3 DAYS)) SCHEDS

  INNER JOIN STAFF ON STAFF.STAFF_ID = SCHEDS.STAFF_ID
  INNER JOIN CONTACT ON CONTACT.CONTACT_ID = STAFF.CONTACT_ID

  WHERE REPLACEMENT_STAFF_ID IS NOT NULL
  
  UNION ALL
  
  SELECT
    CONTACT.FIRSTNAME || ' ' || CONTACT.SURNAME AS "ORIGINAL_TEACHER",
    TO_CHAR((CURRENT DATE - 4 DAYS), 'Month DD') AS "CASUAL_DATE",
    REPLACEMENT,
    REPLACEMENT_STAFF_ID,
    PERIOD,
    START_TIME,
    END_TIME

  FROM TABLE(EDUMATE.GET_SCHEDULES_ON_DATE(CURRENT DATE - 4 DAYS)) SCHEDS

  INNER JOIN STAFF ON STAFF.STAFF_ID = SCHEDS.STAFF_ID
  INNER JOIN CONTACT ON CONTACT.CONTACT_ID = STAFF.CONTACT_ID

  WHERE REPLACEMENT_STAFF_ID IS NOT NULL

  UNION ALL
  
  SELECT
    CONTACT.FIRSTNAME || ' ' || CONTACT.SURNAME AS "ORIGINAL_TEACHER",
    TO_CHAR((CURRENT DATE - 5 DAYS), 'Month DD') AS "CASUAL_DATE",
    REPLACEMENT,
    REPLACEMENT_STAFF_ID,
    PERIOD,
    START_TIME,
    END_TIME

  FROM TABLE(EDUMATE.GET_SCHEDULES_ON_DATE(CURRENT DATE - 5 DAYS)) SCHEDS

  INNER JOIN STAFF ON STAFF.STAFF_ID = SCHEDS.STAFF_ID
  INNER JOIN CONTACT ON CONTACT.CONTACT_ID = STAFF.CONTACT_ID

  WHERE REPLACEMENT_STAFF_ID IS NOT NULL
  
  UNION ALL
  
  SELECT
    CONTACT.FIRSTNAME || ' ' || CONTACT.SURNAME AS "ORIGINAL_TEACHER",
    TO_CHAR((CURRENT DATE - 6 DAYS), 'Month DD') AS "CASUAL_DATE",
    REPLACEMENT,
    REPLACEMENT_STAFF_ID,
    PERIOD,
    START_TIME,
    END_TIME

  FROM TABLE(EDUMATE.GET_SCHEDULES_ON_DATE(CURRENT DATE - 6 DAYS)) SCHEDS

  INNER JOIN STAFF ON STAFF.STAFF_ID = SCHEDS.STAFF_ID
  INNER JOIN CONTACT ON CONTACT.CONTACT_ID = STAFF.CONTACT_ID

  WHERE REPLACEMENT_STAFF_ID IS NOT NULL
  
  UNION ALL
  
  SELECT
    CONTACT.FIRSTNAME || ' ' || CONTACT.SURNAME AS "ORIGINAL_TEACHER",
    TO_CHAR((CURRENT DATE - 7 DAYS), 'Month DD') AS "CASUAL_DATE",
    REPLACEMENT,
    REPLACEMENT_STAFF_ID,
    PERIOD,
    START_TIME,
    END_TIME

  FROM TABLE(EDUMATE.GET_SCHEDULES_ON_DATE(CURRENT DATE - 7 DAYS)) SCHEDS

  INNER JOIN STAFF ON STAFF.STAFF_ID = SCHEDS.STAFF_ID
  INNER JOIN CONTACT ON CONTACT.CONTACT_ID = STAFF.CONTACT_ID

  WHERE REPLACEMENT_STAFF_ID IS NOT NULL
  
  UNION ALL
  
  SELECT
    CONTACT.FIRSTNAME || ' ' || CONTACT.SURNAME AS "ORIGINAL_TEACHER",
    TO_CHAR((CURRENT DATE - 8 DAYS), 'Month DD') AS "CASUAL_DATE",
    REPLACEMENT,
    REPLACEMENT_STAFF_ID,
    PERIOD,
    START_TIME,
    END_TIME

  FROM TABLE(EDUMATE.GET_SCHEDULES_ON_DATE(CURRENT DATE - 8 DAYS)) SCHEDS

  INNER JOIN STAFF ON STAFF.STAFF_ID = SCHEDS.STAFF_ID
  INNER JOIN CONTACT ON CONTACT.CONTACT_ID = STAFF.CONTACT_ID

  WHERE REPLACEMENT_STAFF_ID IS NOT NULL

  UNION ALL
  
  SELECT
    CONTACT.FIRSTNAME || ' ' || CONTACT.SURNAME AS "ORIGINAL_TEACHER",
    TO_CHAR((CURRENT DATE - 9 DAYS), 'Month DD') AS "CASUAL_DATE",
    REPLACEMENT,
    REPLACEMENT_STAFF_ID,
    PERIOD,
    START_TIME,
    END_TIME

  FROM TABLE(EDUMATE.GET_SCHEDULES_ON_DATE(CURRENT DATE - 9 DAYS)) SCHEDS

  INNER JOIN STAFF ON STAFF.STAFF_ID = SCHEDS.STAFF_ID
  INNER JOIN CONTACT ON CONTACT.CONTACT_ID = STAFF.CONTACT_ID

  WHERE REPLACEMENT_STAFF_ID IS NOT NULL

  UNION ALL
  
  SELECT
    CONTACT.FIRSTNAME || ' ' || CONTACT.SURNAME AS "ORIGINAL_TEACHER",
    TO_CHAR((CURRENT DATE - 10 DAYS), 'Month DD') AS "CASUAL_DATE",
    REPLACEMENT,
    REPLACEMENT_STAFF_ID,
    PERIOD,
    START_TIME,
    END_TIME

  FROM TABLE(EDUMATE.GET_SCHEDULES_ON_DATE(CURRENT DATE - 10 DAYS)) SCHEDS

  INNER JOIN STAFF ON STAFF.STAFF_ID = SCHEDS.STAFF_ID
  INNER JOIN CONTACT ON CONTACT.CONTACT_ID = STAFF.CONTACT_ID

  WHERE REPLACEMENT_STAFF_ID IS NOT NULL

  UNION ALL
  
  SELECT
    CONTACT.FIRSTNAME || ' ' || CONTACT.SURNAME AS "ORIGINAL_TEACHER",
    TO_CHAR((CURRENT DATE - 11 DAYS), 'Month DD') AS "CASUAL_DATE",
    REPLACEMENT,
    REPLACEMENT_STAFF_ID,
    PERIOD,
    START_TIME,
    END_TIME

  FROM TABLE(EDUMATE.GET_SCHEDULES_ON_DATE(CURRENT DATE - 11 DAYS)) SCHEDS

  INNER JOIN STAFF ON STAFF.STAFF_ID = SCHEDS.STAFF_ID
  INNER JOIN CONTACT ON CONTACT.CONTACT_ID = STAFF.CONTACT_ID

  WHERE REPLACEMENT_STAFF_ID IS NOT NULL

  UNION ALL
  
  SELECT
    CONTACT.FIRSTNAME || ' ' || CONTACT.SURNAME AS "ORIGINAL_TEACHER",
    TO_CHAR((CURRENT DATE - 12 DAYS), 'Month DD') AS "CASUAL_DATE",
    REPLACEMENT,
    REPLACEMENT_STAFF_ID,
    PERIOD,
    START_TIME,
    END_TIME

  FROM TABLE(EDUMATE.GET_SCHEDULES_ON_DATE(CURRENT DATE - 12 DAYS)) SCHEDS

  INNER JOIN STAFF ON STAFF.STAFF_ID = SCHEDS.STAFF_ID
  INNER JOIN CONTACT ON CONTACT.CONTACT_ID = STAFF.CONTACT_ID

  WHERE REPLACEMENT_STAFF_ID IS NOT NULL

  UNION ALL
  
  SELECT
    CONTACT.FIRSTNAME || ' ' || CONTACT.SURNAME AS "ORIGINAL_TEACHER",
    TO_CHAR((CURRENT DATE - 13 DAYS), 'Month DD') AS "CASUAL_DATE",
    REPLACEMENT,
    REPLACEMENT_STAFF_ID,
    PERIOD,
    START_TIME,
    END_TIME

  FROM TABLE(EDUMATE.GET_SCHEDULES_ON_DATE(CURRENT DATE - 13 DAYS)) SCHEDS

  INNER JOIN STAFF ON STAFF.STAFF_ID = SCHEDS.STAFF_ID
  INNER JOIN CONTACT ON CONTACT.CONTACT_ID = STAFF.CONTACT_ID

  WHERE REPLACEMENT_STAFF_ID IS NOT NULL

  UNION ALL
  
  SELECT
    CONTACT.FIRSTNAME || ' ' || CONTACT.SURNAME AS "ORIGINAL_TEACHER",
    TO_CHAR((CURRENT DATE - 14 DAYS), 'Month DD') AS "CASUAL_DATE",
    REPLACEMENT,
    REPLACEMENT_STAFF_ID,
    PERIOD,
    START_TIME,
    END_TIME

  FROM TABLE(EDUMATE.GET_SCHEDULES_ON_DATE(CURRENT DATE - 14 DAYS)) SCHEDS

  INNER JOIN STAFF ON STAFF.STAFF_ID = SCHEDS.STAFF_ID
  INNER JOIN CONTACT ON CONTACT.CONTACT_ID = STAFF.CONTACT_ID

  WHERE REPLACEMENT_STAFF_ID IS NOT NULL
),

CASUAL_COUNT AS
(
SELECT
    ORIGINAL_TEACHER,
    CASUAL_DATE,
    -- Next line is a fix for Paul's surname. Original field is on the line after.
    CASE WHEN REPLACEMENT LIKE '%Shea' THEN 'Paul O''Shea' ELSE REPLACEMENT END AS REPLACEMENT,
    REPLACEMENT_STAFF_ID,
    PERIOD,
    START_TIME,
    END_TIME

FROM CASUAL_BLOB
WHERE REPLACEMENT_STAFF_ID IN (SELECT STAFF_ID FROM STAFF_EMPLOYMENT WHERE EMPLOYMENT_TYPE_ID IN (3,4))
)

/*
SELECT
    ORIGINAL_TEACHER,
    CASUAL_DATE,
    REPLACEMENT,
    PERIOD,
    START_TIME,
    END_TIME

FROM CASUAL_COUNT

ORDER BY CASUAL_DATE, START_TIME, REPLACEMENT
*/

SELECT
    ORIGINAL_TEACHER,
    CASUAL_DATE,
    REPLACEMENT,
    PERIOD,
    START_TIME,
    END_TIME

FROM CASUAL_COUNT

ORDER BY CASUAL_DATE, START_TIME