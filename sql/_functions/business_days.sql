CREATE OR REPLACE FUNCTION EDUMATE.BUSINESS_DAYS_COUNT  (LOW_DATE DATE, HIGH_DATE DATE)

RETURNS TABLE
(
    BUSINESS_DAYS_COUNT INTEGER
)

LANGUAGE SQL
BEGIN ATOMIC
RETURN
  WITH BUSINESS_DAYS(DAY1) AS
  (
      SELECT LOW_DATE
      FROM SYSIBM.SYSDUMMY1
          UNION ALL
      SELECT DAY1+1 DAY
      FROM BUSINESS_DAYS

      WHERE
        DAY1 < HIGH_DATE
  )
  
  SELECT COUNT(*) AS "BUSINESS_DAYS_COUNT"
  FROM BUSINESS_DAYS
  WHERE DAYOFWEEK(DAY1) BETWEEN 2 AND 6
  AND DAY1 NOT IN ('2013-01-01','2013-01-28','2013-03-29','2013-03-30','2013-03-31','2013-04-10','2013-04-25','2013-06-10','2013-08-5','2013-10-07','2013-12-25','2013-12-26');
END